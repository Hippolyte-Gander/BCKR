{% extends 'base.html.twig' %}

{% block title %}Détails événement{% endblock %}

{% block body %}

<main class="background detail-evenement-background">

    {# ============= section informations ============= #}

    <section class="detail-evenement-infos">
        <div class="detail-evenement-card">
            <h3>{{ evenement.titre }}</h3>

            <article class="detail-evenement-card">
                <p>
                    Date de début : {{ evenement.dateDebutFormatee }} à {{ evenement.heureDebutFormatee }} <br>
                    Date de fin : {{ evenement.dateFinFormatee }} à {{ evenement.heureFinFormatee }}
                </p>

                <p>
                    {{ evenement.description }}
                </p>

                <p class="underline">
                    {% if evenement.visibilite == 'tous' %}
                        Ouvert à tous
                    {% elseif evenement.visibilite == 'membres' %}
                        Ouvert aux membres
                    {% elseif evenement.visibilite == 'admins' %}
                        Ouvert au Comité
                    {% endif %}
                </p>

                <p>
                    Participants inscrits : {{ evenement.getTotalParticipants() }} / {{ evenement.places }}.
                </p>

            </article>
        </div>

        <div class="detail-evenement-affiche">
            {% if evenement.affiche %}
                <img src="{{ asset('/uploads/afficheEvenement/'~evenement.affiche) }} " alt="Affiche de l'événement">
            {% else %}
                <img src="{{ asset('img/affiche-event/affiche-defaut.webp')}}" alt="Photo d'une rencontre sportive">
            {% endif %}
        </div>
    </section>

    <article class="detail-evenement-contenu">
        <p>
            {{ evenement.contenu }}
        </p>
    </article>
    
    {# ============= section participation ============= #}

    <section class="detail-evenement-participation">
        
        <h4>Participants</h4>

        <div class="detail-evenement-inscrits">
            {% if evenement.participationsEvenement|length == 0 %}
                <p>Aucun inscrit pour le moment</p>
            {% else %}
                {% if app.user %}
                    <table>
                        {% for participant in evenement.participationsEvenement %}
                        <td>
                            {{ participant.userInscrit.pseudo }} <i class="fa-solid fa-angles-right"></i> {{ participant.nbrParticipants }} personne(s)
                        </td>
                        {% endfor %}
                    </table>
                {% endif %}
            {% endif %}
        </div>
    </section>

    {# ============= section photos événement ============= #}

    {% if app.user and app.user.estCeQueParticipeDeja(evenement) and evenement.imagesEvenement|length > 0 %}
        <section class="detail-evenement-galerie">
            <h3>Photos de l'événement :</h3>
            {# {{ dump(evenement.imagesEvenement) }} #}
            <div class="detail-evenement-photos">
                {% for photo in evenement.imagesEvenement %}
                    <div class="detail-evenement-photo">
                        <img src="{{ asset('/images/photoDEvenement/'~photo) }} " alt="Photo prise lors de l'événement">
                        <a class="download-btn" href="{{ vich_uploader_asset(photo, 'imageFile') }}" download="{{ photo.name }}">Télécharger cette image</a>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% endif %}

    {# ============= section commentaires ============= #}

    <section class="detail-evenement-commentaires">
        <h4>Commentaires</h4>
        {% if app.user %}
            {% if evenement.commentaires | length > 0 %}
                {% for commentaire in evenement.commentaires %}
                    <div class="detail-evenement-card-commentaire">
                        <p class="text-bold">
                            {{ commentaire.poste.pseudo }} (le {{ commentaire.datePoste|date('d/m/Y') }} à {{ commentaire.datePoste|date('H:i') }}):
                        </p>
                        <p>
                            {{ commentaire.message }}
                        </p>
                        {% if app.user.isAdmin() %}
                            <a class="suppr-btn-formulaire" href="{{ path('suppr_commentaire', {'id': commentaire.id}) }}">Supprimer</a>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                    <p>Soyez le premier à commenter !</p>
            {% endif %}

            {# ============= formulaire commentaire ============= #}
            
            <div class="detail-evenement-commentaire-form">
                {{ form_start(formAddCommentaire) }}
                {{ form_row(formAddCommentaire.message) }}    
                {{ form_row(formAddCommentaire.valider) }}    
                {{ form_end(formAddCommentaire) }}
            </div>
        {% else %}
            <p>
                Connectez-vous pour laisser un commentaire !
            </p>
        {% endif %}
    </section> 
</main>

{% endblock %}