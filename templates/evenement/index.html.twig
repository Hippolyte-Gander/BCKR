{% extends 'base.html.twig' %}

{% block title %}Liste des événements{% endblock %}

{% block body %}

<div class="liste-evenement-background">

    <h4>Liste des événements</h4>
    <a class="texte-utilisateur" href=" {{ path('new_evenement') }} ">Créer un événement</a><br>

    <div class="message-participation">
        {% for label, messages in app.flashes %}
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
        {% endfor %}
    </div>
    {# début image pagination #}
    <div class="count">
        {{ pagination.getTotalItemCount }}
    </div>

    <table>
        <tr class="titre-colonne">
            <td>Nom événement</td>
            <td>Date de début</td>
            <td>Date de fin</td>
            {% if app.user %}
                <td>Participation</td>
            {% endif %}
            {% if app.user  and app.user.isAdmin() %}
                <td>Éditer</td>
                <td>Supprimer</td>
            {% endif %}
        </tr>

        {% for evenement in pagination %}
        
                <tr>
                    <td>
                        <a class="texte-utilisateur" href=" {{ path('show_evenement', {'id': evenement.id}) }} ">{{ evenement.titre }}</a>
                    </td>
                    <td>
                        <a class="texte-utilisateur" href=" {{ path('show_evenement', {'id': evenement.id}) }} "> {{ evenement.dateDebutFormatee }} à {{ evenement.heureDebutFormatee }}</a>
                    </td>
                    <td>
                        <a class="texte-utilisateur" href=" {{ path('show_evenement', {'id': evenement.id}) }} "> {{ evenement.dateFinFormatee }} à {{ evenement.heureFinFormatee }}</a>
                    </td>
                    {# ========== AJOUTER fonction participation ========== #}
                    {% if app.user %}
                        {% if app.user.estCeQueParticipeDeja(evenement)  %}
                            <td>
                                <div class="formulaire">
                                    {{ form_start(formsDel[evenement.id]) }}
                                    <div class="bouton">
                                        {{ form_widget(formsDel[evenement.id].valider) }}
                                    </div>
                                    {{ form_end(formsDel[evenement.id]) }}
                                </div>
                            </td>
                            {% else %}
                            <td>
                                <div class="formulaire">
                                    {{ form_start(formsAdd[evenement.id]) }}
                                    {{ form_row(formsAdd[evenement.id].nbrParticipants) }}
                                    <div class="bouton">
                                        {{ form_widget(formsAdd[evenement.id].valider) }}
                                    </div>
                                    {{ form_end(formsAdd[evenement.id]) }}
                                </div>
                            </td>
                        {% endif %}
                    {% endif %}

                    {% if app.user  and app.user.isAdmin() %}
                        <td>
                            <a class="btn-editer" href="{{ path('edit_evenement', {'id': evenement.id}) }}">Éditer</a>
                        </td>
                        <td>
                            <a class="btn-supprimer" href="{{ path('suppr_evenement', {'id': evenement.id}) }}">Supprimer</a>
                        </td>
                    {% endif %}
                </tr>

        {% endfor %}
    </table>
    <div class="navigation">
        {{ knp_pagination_render(pagination) }}
    </div>

</div>
{% endblock %}